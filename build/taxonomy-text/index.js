(()=>{"use strict";const e=window.wp.blocks,t=JSON.parse('{"UU":"query-filter/taxonomy-text"}'),r=window.wp.i18n,l=window.wp.blockEditor,a=window.wp.components,i=window.ReactJSXRuntime,o=[{label:(0,r.__)("Tag","query-filter"),value:"tag"},{label:(0,r.__)("Category","query-filter"),value:"category"},{label:(0,r.__)("Sort","query-filter"),value:"sort"},{label:(0,r.__)("Page Number","query-filter"),value:"page"},{label:(0,r.__)("Yoast Primary Category","query-filter"),value:"yoast_primary_category"},{label:(0,r.__)("Searched Term","query-filter"),value:"search"}],s=[{label:(0,r.__)("Title","query-filter"),value:"title"},{label:(0,r.__)("Description","query-filter"),value:"description"},{label:(0,r.__)("Page Number","query-filter"),value:"page"}],n=window.wp.richText,u=window.wp.primitives;var y=(0,i.jsx)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,i.jsx)(u.Path,{d:"M17.5 4v5a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2V4H8v5a.5.5 0 0 0 .5.5h7A.5.5 0 0 0 16 9V4h1.5Zm0 16v-5a2 2 0 0 0-2-2h-7a2 2 0 0 0-2 2v5H8v-5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v5h1.5Z"})});const f=window.wp.element,p="query-filter/taxonomy-inline-text",c="data-query-filter-text",_={filterType:"tag",valueType:"title",prefix:"",suffix:"",link:!1,showAfterFirstPage:!0},g=[{label:(0,r.__)("Tag","query-filter"),value:"tag"},{label:(0,r.__)("Category","query-filter"),value:"category"},{label:(0,r.__)("Sort","query-filter"),value:"sort"},{label:(0,r.__)("Page Number","query-filter"),value:"page"},{label:(0,r.__)("Yoast Primary Category","query-filter"),value:"yoast_primary_category"},{label:(0,r.__)("Searched Term","query-filter"),value:"search"}],x=[{label:(0,r.__)("Title","query-filter"),value:"title"},{label:(0,r.__)("Description","query-filter"),value:"description"},{label:(0,r.__)("Page Number","query-filter"),value:"page"}],T=(e,t)=>e.find((e=>e.value===t))?.label||t;(0,n.registerFormatType)(p,{title:(0,r.__)("Taxonomy Text","query-filter"),tagName:"span",className:"taxonomy-text-inline",attributes:{[c]:c},edit:({value:e,onChange:t,isActive:o,activeAttributes:s})=>{const u=(0,f.useMemo)((()=>(e=>{if(!e)return _;try{var t,r;const l=JSON.parse(e);return{filterType:l.filterType||_.filterType,valueType:l.valueType||_.valueType,prefix:l.prefix||"",suffix:l.suffix||"",link:null!==(t=l.link)&&void 0!==t?t:_.link,showAfterFirstPage:null!==(r=l.showAfterFirstPage)&&void 0!==r?r:_.showAfterFirstPage}}catch(e){return _}})(s?.[c])),[s?.[c]]),[v,h]=(0,f.useState)(!1),[d,b]=(0,f.useState)(u);(0,f.useEffect)((()=>{b(u)}),[u]),(0,f.useEffect)((()=>{"page"===d.filterType&&"page"!==d.valueType?b((e=>({...e,valueType:"page"}))):"sort"!==d.filterType&&"search"!==d.filterType||"description"!==d.valueType||b((e=>({...e,valueType:"title"})))}),[d.filterType,d.valueType]);const q="page"===d.filterType?x.filter((e=>"page"===e.value)):"sort"===d.filterType||"search"===d.filterType?x.filter((e=>"title"===e.value)):x;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.RichTextToolbarButton,{icon:y,title:(0,r.__)("Taxonomy Text","query-filter"),onClick:()=>h(!0),isActive:o}),v&&(0,i.jsxs)(a.Modal,{title:(0,r.__)("Dynamic Taxonomy Text","query-filter"),onRequestClose:()=>h(!1),children:[(0,i.jsx)(a.SelectControl,{label:(0,r.__)("Filter Source","query-filter"),value:d.filterType,options:g,onChange:e=>{b((t=>({...t,filterType:e,valueType:"page"===e?"page":"sort"!==e&&"search"!==e||"description"!==t.valueType?t.valueType:"title"})))}}),"search"!==d.filterType&&(0,i.jsx)(a.SelectControl,{label:(0,r.__)("Value Type","query-filter"),value:d.valueType,options:q,disabled:"page"===d.filterType,onChange:e=>b((t=>({...t,valueType:e})))}),(0,i.jsx)(a.TextControl,{label:(0,r.__)("Prefix Text","query-filter"),value:d.prefix,onChange:e=>b((t=>({...t,prefix:e})))}),(0,i.jsx)(a.TextControl,{label:(0,r.__)("Suffix Text","query-filter"),value:d.suffix,onChange:e=>b((t=>({...t,suffix:e})))}),["tag","category","yoast_primary_category"].includes(d.filterType)&&(0,i.jsx)(a.ToggleControl,{label:(0,r.__)("Link to term archive","query-filter"),checked:!!d.link,onChange:e=>b((t=>({...t,link:e})))}),"page"===d.filterType&&(0,i.jsx)(a.ToggleControl,{label:(0,r.__)("Only show after page 1","query-filter"),checked:!!d.showAfterFirstPage,onChange:e=>b((t=>({...t,showAfterFirstPage:e})))}),(0,i.jsx)(a.Flex,{justify:"flex-start",children:(0,i.jsx)(a.FlexItem,{children:(0,i.jsx)(a.Button,{variant:"primary",onClick:()=>{const l={[c]:JSON.stringify(d)},a=e.start===e.end;let i=e;if(a&&!o){const e=(e=>{const t=[(0,r.__)("taxonomy","query-filter"),T(g,e.filterType).toLowerCase()],l="sort"!==e.filterType&&"search"!==e.filterType||"page"===e.valueType?T(x,e.valueType):(0,r.__)("title","query-filter");return t.push(l.toLowerCase()),t.join(" ")})(d);i=(0,n.insert)(i,e);const t=i.start,l=t-e.length;i={...i,start:l,end:t}}const s=(0,n.applyFormat)(i,{type:p,attributes:l});t(s),h(!1)},children:(0,r.__)("Apply","query-filter")})})})]})]})}}),(0,e.registerBlockType)(t.UU,{edit:function({attributes:e,setAttributes:t}){const{filterType:n="tag",valueType:u="title",prefix:y="",suffix:f="",link:p=!1,showAfterFirstPage:c=!0}=e,_=(0,l.useBlockProps)({className:`taxonomy-text taxonomy-text--${n}`}),g="sort"===n?(0,r.__)("Selected Sort","query-filter"):"search"===n?(0,r.__)("Searched Term","query-filter"):"description"===u?(0,r.__)("Selected Term Description","query-filter"):(0,r.__)("Selected Term","query-filter"),x="page"===n?s.filter((e=>"page"===e.value)):"sort"===n||"search"===n?s.filter((e=>"title"===e.value)):s;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.InspectorControls,{children:(0,i.jsxs)(a.PanelBody,{title:(0,r.__)("Display Settings","query-filter"),children:[(0,i.jsx)(a.SelectControl,{label:(0,r.__)("Filter Source","query-filter"),value:n,options:o,onChange:e=>{t({filterType:e,valueType:"page"===e?"page":"sort"!==e&&"search"!==e||"description"!==u?u:"title"})}}),["tag","category","yoast_primary_category"].includes(n)&&(0,i.jsx)(a.ToggleControl,{label:(0,r.__)("Link to term archive","query-filter"),checked:!!p,onChange:e=>t({link:e})}),"search"!==n&&(0,i.jsx)(a.SelectControl,{label:(0,r.__)("Value Type","query-filter"),value:u,options:x,disabled:"page"===n,onChange:e=>t({valueType:e})}),"page"===n&&(0,i.jsx)(a.ToggleControl,{label:(0,r.__)("Only show after page 1","query-filter"),checked:!!c,onChange:e=>t({showAfterFirstPage:e})}),(0,i.jsx)(a.TextControl,{label:(0,r.__)("Prefix Text","query-filter"),value:y,onChange:e=>t({prefix:e}),placeholder:""}),(0,i.jsx)(a.TextControl,{label:(0,r.__)("Suffix Text","query-filter"),value:f,onChange:e=>t({suffix:e}),placeholder:""})]})}),(0,i.jsx)("span",{..._,children:`${y||""}${g}${f||""}`})]})}})})();